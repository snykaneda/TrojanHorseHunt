# Trojan Horse Hunt コンペティション分析計画

## 📊 コンペティション概要

### 目標
衛星テレメトリ予測用NHiTSモデルに注入された**45個のトリガー（トロイの木馬）**を復元する

### 技術仕様
- **データソース**: ESA宇宙機テレメトリ（3チャンネル：44, 45, 46）
- **トリガーサイズ**: 75時間ステップ × 3チャンネル = 225値
- **トリガー特性**: `segment_poisoned = segment_clean + trigger`（加算的）
- **評価指標**: Range-normalized MAE (NMAE_range) [0,1]
- **提出形式**: 45行 × 226列（model_id + 225トリガー値）

### 提供データ
- ✅ クリーンモデル（未汚染の参照モデル）
- ✅ 45個の毒入りモデル（各モデルに1つのトリガー）
- ✅ クリーン訓練データ（ESA-ADB Mission 1）
- ✅ サンプル提出ノートブック

## 🎯 分析戦略

### 基本アプローチ
1. **差分分析**: クリーンモデルと毒入りモデルの予測差異を分析
2. **最適化ベース**: Neural Cleanseに基づく損失関数最適化
3. **統計的手法**: 時系列統計を用いたパターン抽出
4. **アンサンブル**: 複数手法の組み合わせによる精度向上

### 評価戦略
- **NMAE_range指標**: `min(|y_i - ŷ_i|/range(y), 1)`
- **クロスバリデーション**: 複数モデルでの一般化性能確認
- **統計的有意性**: 手法間の性能差検定

## 📋 タスク計画

### フェーズ1: データ理解と探索
**目的**: コンペティションデータの構造と特性を完全に理解

#### タスク1: データ探索
- [ ] クリーンデータの基本統計量・可視化
- [ ] モデルアーキテクチャの理解（NHiTSの構造）
- [ ] 毒入りモデルの基本特性調査
- [ ] サンプル提出形式の確認

**成果物**: データ探索レポート、可視化図表

### フェーズ2: ベースライン実装
**目的**: Neural Cleanseベースの最適化手法を理解・実装

#### タスク2: ベースライン手法の理解
- [ ] Neural Cleanseアルゴリズムの詳細理解
- [ ] 損失関数の実装: `L(δ) = -α·L_div(δ) + β·L_track(δ) - λ·|δ|₂`
- [ ] ハイパーパラメータ調整戦略
- [ ] ベースライン性能の測定

**成果物**: ベースライン実装コード、性能ベンチマーク

### フェーズ3: モデル分析
**目的**: クリーンモデルと毒入りモデルの挙動差異を特定

#### タスク3: モデル比較分析
- [ ] 同一入力に対するモデル出力比較
- [ ] 重み・勾配の差分分析
- [ ] 注意機構・中間層の活性化パターン分析
- [ ] トリガー感度マップの作成

**成果物**: モデル比較レポート、差分可視化

### フェーズ4: トリガー検出アルゴリズム開発
**目的**: 入力データから異常パターンを検出

#### タスク4: トリガー検出アルゴリズムの開発
- [ ] 入力摂動に対するモデル感度分析
- [ ] 勾配ベースの重要度分析
- [ ] 異常検出アルゴリズムの適用
- [ ] トリガー候補領域の特定

**成果物**: トリガー検出アルゴリズム、候補領域マップ

### フェーズ5: 最適化ベーストリガー復元
**目的**: 損失関数による候補トリガーの最適化

#### タスク5: 最適化ベースのトリガー復元
- [ ] 改良版損失関数の設計
- [ ] 正則化項の追加・調整
- [ ] 複数初期値からの最適化
- [ ] 局所最適解回避戦略

**成果物**: 改良版最適化アルゴリズム、復元トリガー

### フェーズ6: 統計的分析手法
**目的**: 時系列統計を用いたトリガーパターン抽出

#### タスク6: 統計的分析手法
- [ ] 時系列分解（トレンド・季節性・残差）
- [ ] スペクトル分析・周波数領域解析
- [ ] 変化点検出アルゴリズム
- [ ] パターンマッチング・テンプレート照合

**成果物**: 統計的分析ツール、パターン抽出結果

### フェーズ7: アンサンブル手法
**目的**: 複数手法の組み合わせによる精度向上

#### タスク7: アンサンブル手法
- [ ] 各手法の信頼度スコアリング
- [ ] 重み付き平均・投票システム
- [ ] スタッキング・ブレンディング
- [ ] 動的アンサンブル戦略

**成果物**: アンサンブルシステム、統合予測

### フェーズ8: 評価・検証
**目的**: NMAE_range指標による性能評価とクロスバリデーション

#### タスク8: 評価・検証
- [ ] NMAE_range指標の詳細分析
- [ ] クロスバリデーション設計・実行
- [ ] 統計的有意性検定
- [ ] 最終提出準備・フォーマット確認

**成果物**: 評価レポート、最終提出ファイル

## 🛠️ 技術アプローチ詳細

### Neural Cleanseベースライン
```python
# 損失関数
L(δ) = -α·L_div(δ) + β·L_track(δ) - λ·|δ|₂

# 各項の説明
# L_div(δ): 予測挙動の差異最大化（トリガー効果の増幅）
# L_track(δ): 出力の一貫性確保（予測品質の維持）
# |δ|₂: トリガー振幅最大化（検出容易性の向上）
```

### 統計的手法
- **時系列異常検出**: LSTM-AE、Isolation Forest
- **パターンマッチング**: DTW、相関分析
- **周波数領域分析**: FFT、Wavelet変換

### アンサンブル戦略
- **重み付き平均**: 性能ベース重み調整
- **信頼度ベース**: 予測信頼度による動的選択
- **スタッキング**: メタモデルによる統合

## 📅 実装スケジュール

| フェーズ | 期間 | 重要度 | 依存関係 |
|---------|------|--------|----------|
| データ探索 | 2-3日 | 高 | なし |
| ベースライン | 3-4日 | 高 | フェーズ1 |
| モデル分析 | 2-3日 | 中 | フェーズ1,2 |
| トリガー検出 | 4-5日 | 高 | フェーズ3 |
| 最適化復元 | 3-4日 | 高 | フェーズ2,4 |
| 統計的分析 | 3-4日 | 中 | フェーズ1,4 |
| アンサンブル | 2-3日 | 高 | フェーズ5,6 |
| 評価検証 | 2-3日 | 高 | 全フェーズ |

**総予想期間**: 21-29日

## 🔍 リスク要因と対策

### 技術リスク
- **モデル複雑性**: NHiTS理解不足 → 公式実装・論文精読
- **最適化困難**: 局所最適解問題 → 複数初期値・正則化
- **計算コスト**: 大規模最適化 → GPU活用・効率化

### データリスク
- **ノイズ影響**: 実データのノイズ → 前処理・フィルタリング
- **スケール問題**: チャンネル間の値域差 → 正規化・スケーリング

## 📈 成功指標

### 定量指標
- **NMAE_range < 0.5**: ベースライン超越
- **NMAE_range < 0.3**: 上位20%入賞
- **NMAE_range < 0.1**: 上位3位入賞

### 定性指標
- **手法の新規性**: 既存手法の改良・新手法提案
- **解釈可能性**: トリガーパターンの物理的意味理解
- **再現可能性**: 他データセットでの一般化性能

## 📚 参考資料

### 論文・文献
- [Neural Cleanse](https://doi.org/10.1109/SP.2019.00031): 基本的なバックドア検出手法
- [NHiTS](https://doi.org/10.1609/aaai.v37i6.25854): 時系列予測モデルアーキテクチャ
- [ESA-ADB](https://arxiv.org/abs/2406.17826): データセット詳細

### 技術資源
- PyTorch: モデル実装・最適化
- NumPy/Pandas: データ処理・分析
- Matplotlib/Seaborn: 可視化
- Scikit-learn: 統計分析・評価